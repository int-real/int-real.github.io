<!DOCTYPE html>
<html>
  <head>
    <meta charset = "utf-8">
    <meta name = "viewport" content = "width=device-width>
    <title>3D</title>
    <link href="style.css" rel="stylesheet" type="text/css" />
    <style>
      a {
		text-align: left;
	  } 
    </style>
  </head>
  <body>
    <h3> <a href="index.html"> <img width="50" height="auto" alt="화살표" src="https://github.com/user-attachments/assets/91fd9e9c-60f0-4510-bc7d-38d602f9c06a" /> </a> </h3>
    <h2>AI Furniture Recommendation</h2>
    <script src="script.js"></script>
    <div><h3>Show your Interior. Then, AI Model will Int-Real you.</h3></div>
<button type="button" onclick="init()">Start</button>
<div id="main-content-container" style="display: flex; justify-content: space-around; margin-top: 20px;"> 
        <div id="classification-area" style="text-align: center;">
            <div id="webcam-container"></div>
            <div id="label-container"></div>
        </div>
        
        <div id="recommendation-area" style="text-align: center; width: 400px; padding: 10px; border: 1px solid #ccc;">
            <h3>추천 가구</h3>
            <div id="furniture-name" style="font-weight: bold; margin-bottom: 10px;">스타일을 분류하면 추천 가구가 나타납니다.</div>
            <img id="furniture-image" src="" alt="추천 가구 이미지" style="max-width: 100%; height: auto; display: none; border: 1px solid #eee;"/>
        </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
<script type="text/javascript">
    // More API functions here:
    // https://github.com/googlecreativelab/teachablemachine-community/tree/master/libraries/image

    // the link to your model provided by Teachable Machine export panel
    const URL = "./my_model/";

	const furnitureData = {
    "Southwestern": {
        name: "사우스웨스턴 패턴 러그",
        image: "https://github.com/user-attachments/assets/2edf58e9-a7dd-4840-aa13-07877ea19c12"
    },
    "Shabby-chic-style": {
        name: "쉐비 시크 빈티지 화이트 의자",
        image: "https://github.com/user-attachments/assets/d800891a-6248-450f-a0f4-cbf919afdb86"
    },
    "Scandinavian": {
        name: "스칸디나비아 원목 암체어",
        image: "https://github.com/user-attachments/assets/9673f136-c046-4083-acd8-cb9a89e077ef"
    },
    "Rustic": {
        name: "러스틱 스타일 통나무 테이블",
        image: "https://github.com/user-attachments/assets/ffda89e3-ec98-4615-bcaa-400b1cd3afe0"
    },
    "Modern": {
        name: "모던 심플 디자인 소파",
        image: "https://github.com/user-attachments/assets/28bcc09d-2d2c-4f14-8914-cb7294371009"
    },
    "Midterranean": {
        name: "지중해풍 타일 무늬 화분",
        image: "https://github.com/user-attachments/assets/fe689c15-b185-424c-914b-5f51887a2df6"
    },
    "Mid-century-modern": {
        name: "미드 센추리 모던 사이드보드",
        image: "https://github.com/user-attachments/assets/bd35dc95-8575-46ad-8d05-2f0548415db2"
    },
    "Industrial": {
        name: "인더스트리얼 메탈 펜던트 조명",
        image: "https://github.com/user-attachments/assets/33cf111f-291b-44b5-bd0b-6cfbd894b9c7"
    },
    "French": {
        name: "프렌치 스타일 샹들리에",
        image: "https://github.com/user-attachments/assets/25bc6c49-b3d5-4fff-9bbe-104ff4c514d2"
    },
    "Farmhouse": {
        name: "팜하우스 스타일 나무 식탁",
        image: "https://github.com/user-attachments/assets/4fac3f9c-bf6a-4ab3-900a-9b969f639666"
    },
    "Electric": {
        name: "일렉트릭 네온 사인 조명",
        image: "https://github.com/user-attachments/assets/dba4085d-d026-4348-af2e-bcca09595bef"
    },
    "Craftsman": {
        name: "크래프츠맨 수제 책장",
        image: "https://github.com/user-attachments/assets/5294f5f3-3044-4174-886a-c0419c8590e0"
    },
    "Contemporary": {
        name: "컨템포러리 추상화 액자",
        image: "https://github.com/user-attachments/assets/74e42820-3ff5-497e-ba1b-d943810c6be5"
    },
    "Coastal": {
        name: "코스탈 스타일 푸른색 쿠션",
        image: "https://github.com/user-attachments/assets/8d564435-7bcc-4119-a142-8d11d0b59822"
    },
    "Asian": {
        name: "아시아풍 대나무 발",
        image: "https://github.com/user-attachments/assets/83cca033-2981-4c4f-9172-ab8e0a89cf50"
    },
    "Victorian": {
        name: "빅토리아 시대 양식 거울",
        image: "https://github.com/user-attachments/assets/b9d24047-4a75-4cd3-aa0b-3d34e4e40936"
    },
    "Tropical": {
        name: "트로피컬 야자수 화분",
        image: "https://github.com/user-attachments/assets/aefcdeac-bacb-4f8d-94c4-22df46218eae"
    },
    "Transitional": {
        name: "트랜지셔널 조합형 테이블 램프",
        image: "https://github.com/user-attachments/assets/9f1a956f-a802-4032-8dfd-64561f5352b8"
    },
    "Traditional": {
        name: "전통 클래식 원목 책상",
        image: "https://github.com/user-attachments/assets/84c93334-4814-4121-88c6-0420ac45c057"
    }
};
	
    let model, webcam, labelContainer, maxPredictions;

    // Load the image model and setup the webcam
    async function init() {
        const modelURL = URL + "model.json";
        const metadataURL = URL + "metadata.json";

        // load the model and metadata
        // Refer to tmImage.loadFromFiles() in the API to support files from a file picker
        // or files from your local hard drive
        // Note: the pose library adds "tmImage" object to your window (window.tmImage)
        model = await tmImage.load(modelURL, metadataURL);
        maxPredictions = model.getTotalClasses();

        // Convenience function to setup a webcam
        const flip = true; // whether to flip the webcam
        webcam = new tmImage.Webcam(400, 400, flip); // width, height, flip
        await webcam.setup(); // request access to the webcam
        await webcam.play();
        window.requestAnimationFrame(loop);

        // append elements to the DOM
        document.getElementById("webcam-container").appendChild(webcam.canvas);
        labelContainer = document.getElementById("label-container");
        for (let i = 0; i < maxPredictions; i++) { // and class labels
            labelContainer.appendChild(document.createElement("div"));
        }
    }

    async function loop() {
        webcam.update(); // update the webcam frame
        await predict();
        window.requestAnimationFrame(loop);
    }

    // run the webcam image through the image model
    async function predict() {
        // predict can take in an image, video or canvas html element
        const prediction = await model.predict(webcam.canvas);

		let maxProbability = -1;
		let maxIndex = -1;
		let maxClassName = "";

		for(let i =0; i<maxPredictions; i++){
			if(prediction[i].probability > maxProbability){
				maxProbability = prediction[i].probability;
				maxIndex = i;
				maxClassName = prediction[i].className;
			}
		}
		
        for (let i = 0; i < maxPredictions; i++) {
            const classPrediction =
                prediction[i].className + ": " + (prediction[i].probability*100).toFixed(2) + "%";
			const labelElement = labelContainer.childNodes[i];
            labelContainer.childNodes[i].innerHTML = classPrediction;

			if (i === maxIndex) {
                labelElement.style.color = "red"; // 빨간색 글씨
                labelElement.style.fontWeight = "bold"; // 선택적으로 굵게
            } else {
                // 이전에 빨간색이었던 것을 다시 검은색(또는 기본색)으로 초기화합니다.
                labelElement.style.color = "black"; 
                labelElement.style.fontWeight = "normal";
            }
        }

		const furnitureNameElement = document.getElementById("furniture-name");
    	const furnitureImageElement = document.getElementById("furniture-image");

    	if (maxClassName && furnitureData[maxClassName]) {
        	const recommendedFurniture = furnitureData[maxClassName];
        
        	furnitureNameElement.innerHTML = `⭐ ${maxClassName} 스타일 추천: **${recommendedFurniture.name}**`;
        	furnitureImageElement.src = recommendedFurniture.image;
        	furnitureImageElement.style.display = "block"; // 이미지 표시
    		} else {
        		// 데이터가 없는 경우 
        		furnitureNameElement.innerHTML = "해당 스타일의 추천 가구 데이터가 없습니다.";
        		furnitureImageElement.src = "";
        		furnitureImageElement.style.display = "none";
		}
    }
</script>

  </body>
</html>
